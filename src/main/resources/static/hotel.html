<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rentigo - Szczegóły miejsca</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
    <style>
        .header {
            background: #1a1a2e;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 60px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: white;
            text-decoration: none;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav {
            display: flex;
            gap: 40px;
        }

        .nav a {
            color: white;
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .nav a:hover {
            opacity: 1;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e67e22;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
            color: white;
        }

        .login-btn {
            color: white;
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .login-btn:hover {
            background: white;
            color: #1a1a2e;
        }

        .gallery {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            grid-template-rows: 200px 200px;
            gap: 8px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .gallery-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.2s;
            position: relative;
        }

        .gallery-item:hover {
            opacity: 0.9;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item:first-child {
            grid-row: span 2;
        }

        .gallery-more {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px 40px;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 30px;
        }

        .hotel-main {
            min-width: 0;
        }

        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .hotel-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .hotel-location {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #666;
            font-size: 15px;
        }

        .hotel-location svg {
            width: 18px;
            height: 18px;
        }

        .hotel-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: #e67e22;
            color: #e67e22;
        }

        .action-btn.active {
            border-color: #e67e22;
            color: #e67e22;
        }

        .action-btn.active svg {
            fill: #e67e22;
        }

        .action-btn svg {
            width: 18px;
            height: 18px;
        }

        .hotel-rating-bar {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        }

        .rating-score-big {
            background: #e67e22;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: 700;
        }

        .rating-details h4 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .rating-details p {
            font-size: 14px;
            color: #666;
        }

        .section-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 16px;
        }

        .description-text {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .feature-item svg {
            width: 24px;
            height: 24px;
            color: #e67e22;
        }

        .feature-item span {
            font-size: 14px;
            color: #333;
        }

        .amenities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .amenity-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
        }

        .amenity-tag svg {
            width: 18px;
            height: 18px;
            color: #e67e22;
        }

        .host-info {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .host-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 28px;
            color: white;
            flex-shrink: 0;
            overflow: hidden;
        }

        .host-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .host-details {
            flex: 1;
        }

        .host-details h4 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .host-details p {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .host-stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .host-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #666;
        }

        .host-stat svg {
            width: 16px;
            height: 16px;
            color: #e67e22;
        }

        .host-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding: 4px 10px;
            background: #fff3e6;
            color: #e67e22;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .reviews-summary {
            display: flex;
            gap: 40px;
            margin-bottom: 24px;
        }

        .review-category {
            flex: 1;
        }

        .review-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .review-category-name {
            font-size: 14px;
            color: #666;
        }

        .review-category-score {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .review-bar {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .review-bar-fill {
            height: 100%;
            background: #e67e22;
            border-radius: 3px;
        }

        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .review-item {
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .review-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 16px;
        }

        .review-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .review-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .review-delete-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #dc3545;
            color: #dc3545;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .review-delete-btn:hover {
            background: #dc3545;
            color: white;
        }

        .review-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .review-author-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            color: #666;
        }

        .review-author-info h5 {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .review-author-info p {
            font-size: 13px;
            color: #999;
        }

        .review-score {
            background: #e67e22;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
        }

        .review-text {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
        }

        .add-review-form {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #eee;
        }

        .add-review-form h4 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }

        .rating-select {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .rating-star {
            width: 32px;
            height: 32px;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }

        .rating-star.active,
        .rating-star:hover {
            color: #e67e22;
        }

        .review-textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
            margin-bottom: 12px;
        }

        .review-textarea:focus {
            border-color: #e67e22;
        }

        .booking-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }

        .booking-price {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 20px;
        }

        .booking-price-amount {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .booking-price-period {
            font-size: 15px;
            color: #666;
        }

        .booking-price-details {
            font-size: 13px;
            color: #999;
            margin-top: 4px;
            margin-bottom: 16px;
        }

        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .booking-dates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .booking-date {
            padding: 12px 16px;
        }

        .booking-date:first-child {
            border-right: 2px solid #e0e0e0;
        }

        .booking-date label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .booking-date input {
            width: 100%;
            border: none;
            font-size: 14px;
            font-family: inherit;
            color: #333;
            outline: none;
        }

        .booking-guests {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
        }

        .booking-guests label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .booking-guests select {
            width: 100%;
            border: none;
            font-size: 14px;
            font-family: inherit;
            color: #333;
            outline: none;
            background: transparent;
        }

        .booking-btn {
            width: 100%;
            padding: 16px;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .booking-btn:hover {
            background: #d35400;
        }

        .booking-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .booking-summary {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .booking-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .booking-row span:first-child {
            color: #666;
        }

        .booking-row span:last-child {
            color: #333;
        }

        .booking-total {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid #eee;
            font-size: 16px;
            font-weight: 600;
        }

        .booking-total span:last-child {
            color: #e67e22;
        }

        .main-loading {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .no-reviews {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .login-prompt {
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 24px;
        }

        .login-prompt a {
            color: #e67e22;
            font-weight: 600;
        }

        @media (max-width: 1000px) {
            .page-container {
                grid-template-columns: 1fr;
            }

            .booking-card {
                position: static;
            }

            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px 30px;
            }

            .nav {
                display: none;
            }

            .gallery {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }

            .gallery-item:first-child {
                grid-row: auto;
            }

            .gallery-item:nth-child(n+3) {
                display: none;
            }

            .hotel-header {
                flex-direction: column;
                gap: 16px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .reviews-summary {
                flex-direction: column;
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">Rentigo</a>
        <div class="header-right">
            <nav class="nav">
                <a href="index.html">Strona główna</a>
                <a href="search.html">Oferty</a>
                <a href="add-place.html">Dodaj miejsce</a>
                <a href="contact.html">Kontakt</a>
            </nav>
            <a href="my-reservations.html" class="user-menu" title="Moje rezerwacje" style="margin-right: -10px;">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </a>
            <a href="favorites.html" class="user-menu" title="Ulubione" style="margin-right: -10px;">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            </a>
            <a href="profile.html" class="user-avatar" style="display: none;"></a>
            <a href="login.html" class="login-btn">Zaloguj się</a>
        </div>
    </header>

    <div class="main-loading" id="mainLoading">
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Ładowanie...</p>
        </div>
    </div>

    <div id="mainContent" style="display: none;">
        <div class="gallery" id="gallery"></div>

        <div class="page-container">
            <div class="hotel-main">
                <div class="hotel-header">
                    <div>
                        <h1 class="hotel-title" id="placeTitle"></h1>
                        <div class="hotel-location" id="placeLocation">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span id="locationText"></span>
                        </div>
                    </div>
                    <div class="hotel-actions">
                        <button class="action-btn" onclick="sharePlace()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                            </svg>
                            Udostępnij
                        </button>
                        <button class="action-btn" id="favoriteBtn" onclick="toggleFavorite()">
                            <svg id="favoriteIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                            Zapisz
                        </button>
                    </div>
                </div>

                <div class="hotel-rating-bar" id="ratingBar" style="display: none;">
                    <div class="rating-score-big" id="ratingScore"></div>
                    <div class="rating-details">
                        <h4 id="ratingText"></h4>
                        <p id="reviewCount"></p>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">O miejscu</h2>
                    <p class="description-text" id="placeDescription"></p>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Szczegóły</h2>
                    <div class="features-grid" id="featuresGrid"></div>
                </div>

                <div class="section-card" id="amenitiesSection" style="display: none;">
                    <h2 class="section-title">Udogodnienia</h2>
                    <div class="amenities-list" id="amenitiesList"></div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Gospodarz</h2>
                    <div class="host-info">
                        <div class="host-avatar" id="hostAvatar"></div>
                        <div class="host-details">
                            <h4 id="hostName"></h4>
                            <p id="hostRole"></p>
                            <p id="hostSince"></p>
                            <div class="host-stats" id="hostStats"></div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Opinie gości</h2>

                    <div class="reviews-summary" id="reviewsSummary" style="display: none;"></div>

                    <div class="reviews-list" id="reviewsList"></div>

                    <div id="addReviewSection"></div>
                </div>
            </div>

            <aside>
                <div class="booking-card">
                    <div class="booking-price">
                        <span class="booking-price-amount" id="priceAmount"></span>
                        <span class="booking-price-period">/ noc</span>
                    </div>
                    <div class="booking-price-details" id="cleaningFeeInfo"></div>

                    <form class="booking-form" id="bookingForm">
                        <div class="booking-dates">
                            <div class="booking-date">
                                <label>Zameldowanie</label>
                                <input type="date" id="checkIn" required>
                            </div>
                            <div class="booking-date">
                                <label>Wymeldowanie</label>
                                <input type="date" id="checkOut" required>
                            </div>
                        </div>
                        <div class="booking-guests">
                            <label>Goście</label>
                            <select id="guestsSelect"></select>
                        </div>
                        <button type="submit" class="booking-btn" id="bookBtn">Zarezerwuj</button>
                    </form>

                    <div class="booking-summary" id="bookingSummary">
                        <div class="booking-row">
                            <span id="priceCalculation"></span>
                            <span id="subtotal"></span>
                        </div>
                        <div class="booking-row" id="cleaningFeeRow" style="display: none;">
                            <span>Opłata za sprzątanie</span>
                            <span id="cleaningFeeAmount"></span>
                        </div>
                        <div class="booking-row">
                            <span>Opłata serwisowa (5%)</span>
                            <span id="serviceFee"></span>
                        </div>
                        <div class="booking-total">
                            <span>Razem</span>
                            <span id="totalPrice"></span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        let place = null;
        let placeId = null;
        let isFavorite = false;
        let selectedRating = 5;

        document.addEventListener('DOMContentLoaded', async () => {
            updateAuthUI();

            const urlParams = new URLSearchParams(window.location.search);
            placeId = urlParams.get('id');

            if (!placeId) {
                document.getElementById('mainLoading').innerHTML = `
                    <div class="error-state">
                        <h3>Nie znaleziono miejsca</h3>
                        <p>Brak identyfikatora miejsca w URL</p>
                        <a href="search.html" class="btn btn-primary">Przeglądaj oferty</a>
                    </div>
                `;
                return;
            }

            await loadPlace();
        });

        async function loadPlace() {
            try {
                place = await api.getPlace(placeId);
                document.title = `Rentigo - ${place.name}`;

                renderGallery();
                renderPlaceDetails();
                await loadReviews();
                await checkFavorite();
                setupBookingForm();

                document.getElementById('mainLoading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } catch (error) {
                document.getElementById('mainLoading').innerHTML = `
                    <div class="error-state">
                        <h3>Wystąpił błąd</h3>
                        <p>${error.message}</p>
                        <a href="search.html" class="btn btn-primary">Przeglądaj oferty</a>
                    </div>
                `;
            }
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const images = place.images || [];

            if (images.length === 0) {
                gallery.innerHTML = `
                    <div class="gallery-item main">
                        <img src="/images/placeholder.jpg" alt="Brak zdjęcia">
                    </div>
                `;
                return;
            }

            gallery.innerHTML = images.map((img, i) => `
                <div class="gallery-item ${i === 0 ? 'main' : ''}">
                    <img src="${img.url}" alt="Zdjęcie ${i+1}" loading="lazy">
                </div>
            `).join('');
        }

        function renderPlaceDetails() {
            document.getElementById('placeTitle').textContent = place.name;
            document.getElementById('locationText').textContent = `${place.cityName || 'Polska'}${place.address ? ', ' + place.address : ''}`;
            document.getElementById('placeDescription').innerHTML = place.description ? place.description.replace(/\n/g, '<br>') : 'Brak opisu';
            document.getElementById('priceAmount').textContent = formatPrice(place.pricePerNight);

            if (place.cleaningFee && place.cleaningFee > 0) {
                document.getElementById('cleaningFeeInfo').textContent = `+ ${formatPrice(place.cleaningFee)} opłata za sprzątanie`;
            } else {
                document.getElementById('cleaningFeeInfo').textContent = 'Bez opłaty za sprzątanie';
            }

            if (place.rating) {
                document.getElementById('ratingBar').style.display = 'flex';
                document.getElementById('ratingScore').textContent = place.rating.toFixed(1);
                document.getElementById('ratingText').textContent = getRatingText(place.rating);
                document.getElementById('reviewCount').textContent = `Na podstawie ${place.reviewCount || 0} opinii`;
            }

            document.getElementById('featuresGrid').innerHTML = `
                <div class="feature-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span>Do ${place.maxGuests} gości</span>
                </div>
                <div class="feature-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span>${place.bedrooms} ${place.bedrooms === 1 ? 'sypialnia' : 'sypialnie'}</span>
                </div>
                <div class="feature-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <span>${place.bathrooms || 1} ${(place.bathrooms || 1) === 1 ? 'łazienka' : 'łazienki'}</span>
                </div>
                ${place.area ? `
                <div class="feature-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                    </svg>
                    <span>${place.area} m²</span>
                </div>
                ` : ''}
                <div class="feature-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Typ: ${getPlaceTypeName(place.type)}</span>
                </div>
            `;

            if (place.amenities && place.amenities.length > 0) {
                document.getElementById('amenitiesSection').style.display = 'block';
                document.getElementById('amenitiesList').innerHTML = place.amenities.map(amenity => `
                    <div class="amenity-tag">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        ${amenity.name}
                    </div>
                `).join('');
            }

            if (place.owner) {
                const owner = place.owner;
                const initials = owner.initials || ((owner.firstName?.charAt(0) || '') + (owner.lastName?.charAt(0) || ''));

                const avatarEl = document.getElementById('hostAvatar');
                if (owner.avatarUrl) {
                    avatarEl.innerHTML = `<img src="${owner.avatarUrl}" alt="${owner.firstName} ${owner.lastName}">`;
                } else {
                    avatarEl.textContent = initials || 'H';
                }

                document.getElementById('hostName').textContent = `${owner.firstName || ''} ${owner.lastName || ''}`.trim() || 'Gospodarz';

                const roleText = owner.role === 'ADMIN' ? 'Administrator' : 'Gospodarz';
                document.getElementById('hostRole').textContent = roleText;

                if (owner.createdAt) {
                    const joinDate = new Date(owner.createdAt);
                    const monthYear = joinDate.toLocaleDateString('pl-PL', { month: 'long', year: 'numeric' });
                    document.getElementById('hostSince').textContent = `Dołączył(a) ${monthYear}`;
                }

                const statsHtml = `
                    <div class="host-stat">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Zweryfikowany gospodarz
                    </div>
                `;
                document.getElementById('hostStats').innerHTML = statsHtml;
            }

            addOwnerAdminActions();
        }

        function addOwnerAdminActions() {
            if (!api.user) return;

            const isOwner = place.owner && api.user.id === place.owner.id;
            const isAdmin = api.user.role === 'ADMIN';

            if (!isOwner && !isAdmin) return;

            const actionsContainer = document.querySelector('.hotel-actions');
            if (!actionsContainer) return;

            if (isOwner || isAdmin) {
                const editBtn = document.createElement('a');
                editBtn.href = `edit-place.html?id=${placeId}`;
                editBtn.className = 'action-btn';
                editBtn.title = 'Edytuj';
                editBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edytuj
                `;
                actionsContainer.insertBefore(editBtn, actionsContainer.firstChild);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn';
                deleteBtn.title = 'Usuń';
                deleteBtn.style.color = '#dc3545';
                deleteBtn.onclick = deletePlace;
                deleteBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Usuń
                `;
                actionsContainer.insertBefore(deleteBtn, actionsContainer.firstChild);
            }
        }

        async function deletePlace() {
            if (!confirm(`Czy na pewno chcesz usunąć "${place.name}"? Ta operacja jest nieodwracalna.`)) {
                return;
            }

            try {
                await api.request(`/places/${placeId}`, { method: 'DELETE' });
                showToast('Miejsce zostało usunięte', 'success');
                setTimeout(() => window.location.href = 'my-places.html', 1500);
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function deleteReview(reviewId) {
            if (!confirm('Czy na pewno chcesz usunąć tę opinię?')) {
                return;
            }

            try {
                await api.request(`/reviews/${reviewId}`, { method: 'DELETE' });
                showToast('Opinia została usunięta', 'success');
                loadReviews();
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function loadReviews() {
            try {
                const [reviews, summary] = await Promise.all([
                    api.getReviews(placeId),
                    api.getReviewSummary(placeId).catch(() => null)
                ]);

                if (summary && summary.reviewCount > 0) {
                    document.getElementById('reviewsSummary').style.display = 'flex';
                    document.getElementById('reviewsSummary').innerHTML = `
                        <div class="review-category">
                            <div class="review-category-header">
                                <span class="review-category-name">Czystość</span>
                                <span class="review-category-score">${(summary.avgCleanliness || 0).toFixed(1)}</span>
                            </div>
                            <div class="review-bar">
                                <div class="review-bar-fill" style="width: ${(summary.avgCleanliness || 0) * 10}%"></div>
                            </div>
                        </div>
                        <div class="review-category">
                            <div class="review-category-header">
                                <span class="review-category-name">Lokalizacja</span>
                                <span class="review-category-score">${(summary.avgLocation || 0).toFixed(1)}</span>
                            </div>
                            <div class="review-bar">
                                <div class="review-bar-fill" style="width: ${(summary.avgLocation || 0) * 10}%"></div>
                            </div>
                        </div>
                        <div class="review-category">
                            <div class="review-category-header">
                                <span class="review-category-name">Komunikacja</span>
                                <span class="review-category-score">${(summary.avgCommunication || 0).toFixed(1)}</span>
                            </div>
                            <div class="review-bar">
                                <div class="review-bar-fill" style="width: ${(summary.avgCommunication || 0) * 10}%"></div>
                            </div>
                        </div>
                        <div class="review-category">
                            <div class="review-category-header">
                                <span class="review-category-name">Wartość</span>
                                <span class="review-category-score">${(summary.avgValue || 0).toFixed(1)}</span>
                            </div>
                            <div class="review-bar">
                                <div class="review-bar-fill" style="width: ${(summary.avgValue || 0) * 10}%"></div>
                            </div>
                        </div>
                    `;
                }

                if (reviews && reviews.length > 0) {
                    const isAdmin = api.user && api.user.role === 'ADMIN';

                    document.getElementById('reviewsList').innerHTML = reviews.map(review => `
                        <div class="review-item">
                            <div class="review-header">
                                <div class="review-header-left">
                                    <div class="review-author">
                                        <div class="review-author-avatar">${review.userInitials || 'U'}</div>
                                        <div class="review-author-info">
                                            <h5>${review.userName || 'Użytkownik'}</h5>
                                            <p>${formatDate(review.createdAt)}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="review-header-right">
                                    <div class="review-score">${review.rating.toFixed(1)}</div>
                                    ${isAdmin ? `<button class="review-delete-btn" onclick="deleteReview(${review.id})">Usuń</button>` : ''}
                                </div>
                            </div>
                            <p class="review-text">${review.comment || ''}</p>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('reviewsList').innerHTML = `
                        <div class="no-reviews">
                            <p>Brak opinii dla tego miejsca</p>
                        </div>
                    `;
                }

                renderAddReviewForm();
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        function renderAddReviewForm() {
            const section = document.getElementById('addReviewSection');

            if (!api.isLoggedIn()) {
                section.innerHTML = `
                    <div class="login-prompt">
                        <p><a href="login.html">Zaloguj się</a>, aby dodać opinię</p>
                    </div>
                `;
                return;
            }

            section.innerHTML = `
                <div class="add-review-form">
                    <h4>Dodaj swoją opinię</h4>
                    <div class="rating-select" id="ratingStars">
                        ${[1,2,3,4,5,6,7,8,9,10].map(i => `
                            <svg class="rating-star ${i <= selectedRating ? 'active' : ''}"
                                 onclick="setRating(${i})"
                                 fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        `).join('')}
                    </div>
                    <textarea class="review-textarea" id="reviewComment" placeholder="Podziel się swoimi wrażeniami z pobytu..."></textarea>
                    <button class="btn btn-primary" onclick="submitReview()">Dodaj opinię</button>
                </div>
            `;
        }

        function setRating(rating) {
            selectedRating = rating;
            const stars = document.querySelectorAll('#ratingStars .rating-star');
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }

        async function submitReview() {
            const comment = document.getElementById('reviewComment').value.trim();

            if (!comment) {
                alert('Proszę dodać komentarz');
                return;
            }

            try {
                await api.createReview({
                    placeId: parseInt(placeId),
                    rating: selectedRating,
                    cleanlinessRating: selectedRating,
                    locationRating: selectedRating,
                    valueRating: selectedRating,
                    communicationRating: selectedRating,
                    comment: comment
                });

                await loadReviews();
                await loadPlace();
            } catch (error) {
                alert(error.message);
            }
        }

        async function checkFavorite() {
            if (!api.isLoggedIn()) return;

            try {
                const favorites = await api.getFavorites();
                isFavorite = favorites.some(f => f.placeId === parseInt(placeId));
                updateFavoriteButton();
            } catch (error) {
                console.error('Error checking favorite:', error);
            }
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('favoriteBtn');
            const icon = document.getElementById('favoriteIcon');

            if (isFavorite) {
                btn.classList.add('active');
                icon.setAttribute('fill', '#e67e22');
            } else {
                btn.classList.remove('active');
                icon.setAttribute('fill', 'none');
            }
        }

        async function toggleFavorite() {
            if (!api.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            try {
                await api.toggleFavorite(placeId);
                isFavorite = !isFavorite;
                updateFavoriteButton();
            } catch (error) {
                console.error('Error toggling favorite:', error);
            }
        }

        function setupBookingForm() {
            const guestsSelect = document.getElementById('guestsSelect');
            for (let i = 1; i <= place.maxGuests; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} ${i === 1 ? 'gość' : 'gości'}`;
                if (i === 2) option.selected = true;
                guestsSelect.appendChild(option);
            }

            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dayAfter = new Date();
            dayAfter.setDate(dayAfter.getDate() + 4);

            document.getElementById('checkIn').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('checkIn').min = tomorrow.toISOString().split('T')[0];
            document.getElementById('checkOut').value = dayAfter.toISOString().split('T')[0];

            updateBookingSummary();

            document.getElementById('checkIn').addEventListener('change', updateBookingSummary);
            document.getElementById('checkOut').addEventListener('change', updateBookingSummary);

            document.getElementById('bookingForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                if (!api.isLoggedIn()) {
                    window.location.href = 'login.html';
                    return;
                }

                const checkIn = document.getElementById('checkIn').value;
                const checkOut = document.getElementById('checkOut').value;
                const guests = document.getElementById('guestsSelect').value;

                const btn = document.getElementById('bookBtn');
                btn.disabled = true;
                btn.textContent = 'Rezerwowanie...';

                try {
                    await api.createReservation({
                        placeId: parseInt(placeId),
                        checkIn: checkIn,
                        checkOut: checkOut,
                        guests: parseInt(guests)
                    });

                    alert('Rezerwacja została utworzona!');
                    window.location.href = 'my-reservations.html';
                } catch (error) {
                    alert(error.message);
                    btn.disabled = false;
                    btn.textContent = 'Zarezerwuj';
                }
            });
        }

        function updateBookingSummary() {
            const checkIn = new Date(document.getElementById('checkIn').value);
            const checkOut = new Date(document.getElementById('checkOut').value);

            if (checkOut <= checkIn) {
                checkOut.setDate(checkIn.getDate() + 1);
                document.getElementById('checkOut').value = checkOut.toISOString().split('T')[0];
            }

            const nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));
            const subtotal = place.pricePerNight * nights;
            const cleaningFee = place.cleaningFee || 0;
            const serviceFee = Math.round(subtotal * 0.05);
            const total = subtotal + cleaningFee + serviceFee;

            document.getElementById('priceCalculation').textContent = `${formatPrice(place.pricePerNight)} × ${nights} ${nights === 1 ? 'noc' : 'noce'}`;
            document.getElementById('subtotal').textContent = formatPrice(subtotal);

            if (cleaningFee > 0) {
                document.getElementById('cleaningFeeRow').style.display = 'flex';
                document.getElementById('cleaningFeeAmount').textContent = formatPrice(cleaningFee);
            } else {
                document.getElementById('cleaningFeeRow').style.display = 'none';
            }

            document.getElementById('serviceFee').textContent = formatPrice(serviceFee);
            document.getElementById('totalPrice').textContent = formatPrice(total);
        }

        function sharePlace() {
            if (navigator.share) {
                navigator.share({
                    title: place.name,
                    text: `Sprawdź to miejsce: ${place.name}`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Link skopiowany do schowka!');
            }
        }

        function getRatingText(rating) {
            if (rating >= 9) return 'Wyjątkowy';
            if (rating >= 8) return 'Znakomity';
            if (rating >= 7) return 'Bardzo dobry';
            if (rating >= 6) return 'Dobry';
            return 'Przeciętny';
        }

        function getPlaceTypeName(type) {
            const types = {
                'APARTMENT': 'Apartament',
                'STUDIO': 'Studio',
                'HOUSE': 'Dom',
                'ROOM': 'Pokój',
                'LOFT': 'Loft'
            };
            return types[type] || type;
        }

        function showToast(message, type = '') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
